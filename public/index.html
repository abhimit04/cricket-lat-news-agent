<div id="three-container" style="width: 100%; height: 400px; position: relative; z-index: 1;"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.15.0/gsap.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      let scene, camera, renderer, spheres = [];

      const container = document.getElementById("three-container");
      const containerWidth = container.clientWidth;
      const containerHeight = container.clientHeight;

      // Initialize Three.js
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, containerWidth / containerHeight, 0.1, 1000);
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(containerWidth, containerHeight);
      container.appendChild(renderer.domElement);

      const light = new THREE.PointLight(0xffffff, 1);
      light.position.set(10, 10, 10);
      scene.add(light);

      camera.position.z = 8;

      // Animate function
      function animate() {
        requestAnimationFrame(animate);
        spheres.forEach(s => s.rotation.y += 0.01);
        renderer.render(scene, camera);
      }
      animate();

      // Function to create spheres dynamically
      function createSpheres(headlines) {
        // Remove old spheres
        spheres.forEach(s => scene.remove(s));
        spheres = [];

        headlines.forEach((headline, i) => {
          const geometry = new THREE.SphereGeometry(0.5, 32, 32);
          const material = new THREE.MeshStandardMaterial({
            color: new THREE.Color(`hsl(${(i * 50) % 360}, 70%, 50%)`)
          });
          const sphere = new THREE.Mesh(geometry, material);

          sphere.position.set(Math.random() * 8 - 4, Math.random() * 2 - 1, Math.random() * -5);
          scene.add(sphere);
          spheres.push(sphere);

          // GSAP animations
          gsap.to(sphere.position, {
            y: "+=2",
            duration: 2 + Math.random() * 2,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: i * 0.2
          });
          gsap.to(sphere.rotation, {
            y: "+=6.28",
            duration: 4 + Math.random() * 4,
            repeat: -1,
            ease: "linear"
          });
        });
      }

      // Load news & update spheres
      window.loadNews = async function() {
        const output = document.getElementById('output');
        output.innerHTML = "<div class='loading'>Loading news...</div>";

        try {
          const res = await fetch('/api/cricket-report');
          const data = await res.json();

          if (!data.success || data.count === 0) {
            output.innerHTML = `<div class="error">No news available</div>`;
            return;
          }

          if (data.news && data.news.length) {
            createSpheres(data.news);
          }

          // AI Summary
          let html = `
            <div class="summary">
              <h2> Latest cricket news for you ðŸ“°</h2>
              <ul>
                ${data.summary
                  .split("\n")
                  .map(line => line ? `<li>${line.replace(/^-/, "").trim()}</li>` : "")
                  .join("")}
              </ul>
            </div>
          `;

          // News Grid
          html += `<div class="news-grid">`;
          data.news.forEach(item => {
            html += `
              <div class="news-card">
                <h2>${item.headline}</h2>
                <p><strong>Source:</strong> ${item.source}</p>
                <p>${item.summary}</p>
                <a href="${item.link}" target="_blank">Read more ðŸ”—</a>
              </div>
            `;
          });
          html += `</div>`;

          output.innerHTML = html;
        } catch (err) {
          output.innerHTML = `<div class="error">Error loading news: ${err.message}</div>`;
        }
      };
    });
</script>
